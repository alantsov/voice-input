#!/usr/bin/make -f
%:
	dh $@

override_dh_auto_build:
	# Always build with CUDA support, regardless of whether CUDA dependencies are found
	echo "Building with CUDA support enabled"
	# Create necessary directories for CUDA compilation
	mkdir -p ggml/src/ggml-cuda/CMakeFiles/ggml-cuda.dir/template-instances
	# Set environment variable to explicitly enable CUDA
	export CARGO_FEATURE_CUDA=1
	# Build with CUDA support
	cargo build --release --features tray-icon --features cuda

override_dh_auto_install:
	mkdir -p debian/voice-input/usr/bin
	cp target/release/voice_input debian/voice-input/usr/bin/voice-input
	# Install icons into hicolor theme directories
	mkdir -p debian/voice-input/usr/share/icons/hicolor
	cp -r assets/icons/hicolor/* debian/voice-input/usr/share/icons/hicolor/

override_dh_auto_clean:
	cargo clean
	dh_auto_clean

override_dh_shlibdeps:
	dh_shlibdeps --dpkg-shlibdeps-params="--ignore-missing-info -xlibnvidia-compute-565"
